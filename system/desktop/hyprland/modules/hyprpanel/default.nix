{
  config,
  lib,
  pkgs,
  ...
}:

let
  inherit (lib) mapAttrs;
  cfg = config.icedos;
  accentColor = cfg.internals.accentColor;
  killCommand = "killall -9 .hyprpanel-wrapped";
  package = pkgs.hyprpanel;
in
{
  environment.systemPackages = [ package ];
  services.power-profiles-daemon.enable = true;

  home-manager.users = mapAttrs (user: _: {
    wayland.windowManager.hyprland.settings.bind = [ "CTRL ALT, DELETE, exec, ${killCommand}" ];

    home.file = {
      ".config/hyprpanel/config.json" = {
        force = true;
        text = ''
          {
            "bar.customModules.updates.pollingInterval": 1440000,
            "wallpaper.enable": false,
            "theme.bar.menus.background": "#000000",
            "theme.bar.menus.cards": "#242424",
            "theme.bar.menus.card_radius": "0.5em",
            "theme.bar.menus.label": "#ffffff",
            "theme.bar.menus.text": "#ffffff",
            "theme.bar.menus.dimtext": "#939393",
            "theme.bar.menus.feinttext": "#606060",
            "theme.bar.menus.border.size": "0.1em",
            "theme.bar.menus.border.radius": "0.5em",
            "theme.bar.menus.border.color": "#333333",
            "theme.bar.menus.popover.radius": "0.5em",
            "theme.bar.menus.popover.text": "#ffffff",
            "theme.bar.menus.popover.background": "#242424",
            "theme.bar.menus.listitems.active": "${accentColor}",
            "theme.bar.menus.listitems.passive": "#545454",
            "theme.bar.menus.icons.active": "#ffffff",
            "theme.bar.menus.icons.passive": "#545454",
            "theme.bar.menus.switch.enabled": "${accentColor}",
            "theme.bar.menus.switch.disabled": "#545454",
            "theme.bar.menus.switch.radius": "0.5em",
            "theme.bar.menus.switch.slider_radius": "0.5em",
            "theme.bar.menus.switch.puck": "#ffffff",
            "theme.bar.menus.check_radio_button.background": "#545454",
            "theme.bar.menus.check_radio_button.active": "${accentColor}",
            "theme.bar.menus.buttons.radius": "0.5em",
            "theme.bar.menus.buttons.default": "#3a3a3a",
            "theme.bar.menus.buttons.active": "${accentColor}",
            "theme.bar.menus.buttons.disabled": "#545454",
            "theme.bar.menus.buttons.text": "#ffffff",
            "theme.bar.menus.iconbuttons.passive": "#ffffff",
            "theme.bar.menus.iconbuttons.active": "${accentColor}",
            "theme.bar.menus.progressbar.radius": "0.5rem",
            "theme.bar.menus.progressbar.foreground": "${accentColor}",
            "theme.bar.menus.progressbar.background": "#363636",
            "theme.bar.menus.slider.primary": "${accentColor}",
            "theme.bar.menus.slider.background": "#363636",
            "theme.bar.menus.slider.backgroundhover": "#3c3c3c",
            "theme.bar.menus.slider.progress_radius": "0.5rem",
            "theme.bar.menus.slider.slider_radius": "0.5rem",
            "theme.bar.menus.slider.puck": "#ffffff",
            "theme.bar.menus.scroller.radius": "0.5em",
            "theme.bar.menus.dropdownmenu.background": "#242424",
            "theme.bar.menus.dropdownmenu.text": "#ffffff",
            "theme.bar.menus.dropdownmenu.divider": "#616161",
            "theme.bar.menus.tooltip.radius": "0.5em",
            "theme.bar.menus.tooltip.background": "#242424",
            "theme.bar.menus.tooltip.text": "#ffffff",
            "theme.bar.transparent": false,
            "theme.bar.background": "#000000",
            "theme.bar.buttons.style": "default",
            "theme.bar.buttons.monochrome": false,
            "theme.bar.buttons.background": "#242438",
            "theme.bar.buttons.dashboard.background": "#1e1e1e",
            "theme.bar.buttons.dashboard.icon": "#ffffff",
            "theme.bar.buttons.workspaces.background": "#1e1e1e",
            "theme.bar.buttons.workspaces.hover": "#c0bfbc",
            "theme.bar.buttons.workspaces.available": "#303030",
            "theme.bar.buttons.workspaces.occupied": "#303030",
            "theme.bar.buttons.workspaces.active": "#ffffff",
            "theme.bar.buttons.workspaces.numbered_active_highlighted_text_color": "#181825",
            "theme.bar.buttons.workspaces.numbered_active_underline_color": "#f5c2e7",
            "theme.bar.buttons.workspaces.border": "#f5c2e7",
            "theme.bar.buttons.windowtitle.background": "#1e1e1e",
            "theme.bar.buttons.windowtitle.text": "#ffffff",
            "theme.bar.buttons.windowtitle.icon": "#ffffff",
            "theme.bar.buttons.media.background": "#1e1e1e",
            "theme.bar.buttons.media.text": "#ffffff",
            "theme.bar.buttons.media.icon": "#ffffff",
            "theme.bar.buttons.volume.background": "#1e1e1e",
            "theme.bar.buttons.volume.text": "#ffffff",
            "theme.bar.buttons.volume.icon": "#ffffff",
            "theme.bar.buttons.network.background": "#1e1e1e",
            "theme.bar.buttons.network.text": "#ffffff",
            "theme.bar.buttons.network.icon": "#ffffff",
            "theme.bar.buttons.bluetooth.background": "#1e1e1e",
            "theme.bar.buttons.bluetooth.text": "#ffffff",
            "theme.bar.buttons.bluetooth.icon": "#ffffff",
            "theme.bar.buttons.systray.customIcon": "#ffffff",
            "theme.bar.buttons.systray.background": "#1e1e1e",
            "theme.bar.buttons.battery.background": "#1e1e1e",
            "theme.bar.buttons.battery.text": "#ffffff",
            "theme.bar.buttons.battery.icon": "#ffffff",
            "theme.bar.buttons.clock.background": "#1e1e1e",
            "theme.bar.buttons.clock.text": "#ffffff",
            "theme.bar.buttons.clock.icon": "#ffffff",
            "theme.bar.buttons.notifications.background": "#1e1e1e",
            "theme.bar.buttons.notifications.total": "#ffffff",
            "theme.bar.buttons.notifications.icon": "#ffffff",
            "theme.bar.menus.menu.battery.text": "#ffffff",
            "theme.bar.menus.menu.battery.card.color": "#242424",
            "theme.bar.menus.menu.battery.background.color": "#1e1e1e",
            "theme.bar.menus.menu.battery.label.color": "#ffffff",
            "theme.bar.menus.menu.battery.listitems.active": "#ffffff",
            "theme.bar.menus.menu.battery.icons.active": "#ffffff",
            "theme.bar.menus.menu.battery.icons.passive": "#606060",
            "theme.bar.menus.menu.battery.listitems.passive": "#606060",
            "theme.bar.menus.menu.battery.slider.primary": "${accentColor}",
            "theme.bar.menus.menu.battery.slider.background": "#363636",
            "theme.bar.menus.menu.battery.slider.backgroundhover": "#3c3c3c",
            "theme.bar.menus.menu.battery.slider.puck": "#ffffff",
            "theme.bar.menus.menu.battery.border.color": "#333333",
            "theme.bar.menus.menu.bluetooth.text": "#ffffff",
            "theme.bar.menus.menu.bluetooth.card.color": "#242424",
            "theme.bar.menus.menu.bluetooth.background.color": "#1e1e1e",
            "theme.bar.menus.menu.bluetooth.border.color": "#333333",
            "theme.bar.menus.menu.bluetooth.label.color": "#ffffff",
            "theme.bar.menus.menu.bluetooth.listitems.active": "#939393",
            "theme.bar.menus.menu.bluetooth.listitems.passive": "#ffffff",
            "theme.bar.menus.menu.bluetooth.icons.passive": "#ffffff",
            "theme.bar.menus.menu.bluetooth.icons.active": "#939393",
            "theme.bar.menus.menu.bluetooth.iconbutton.active": "#939393",
            "theme.bar.menus.menu.bluetooth.iconbutton.passive": "#ffffff",
            "theme.bar.menus.menu.bluetooth.scroller.color": "#ffffff",
            "theme.bar.menus.menu.bluetooth.switch.enabled": "${accentColor}",
            "theme.bar.menus.menu.bluetooth.switch.disabled": "#545454",
            "theme.bar.menus.menu.bluetooth.switch.puck": "#ffffff",
            "theme.bar.menus.menu.bluetooth.switch_divider": "#939393",
            "theme.bar.menus.menu.clock.text": "#ffffff",
            "theme.bar.menus.menu.clock.card.color": "#242424",
            "theme.bar.menus.menu.clock.background.color": "#1e1e1e",
            "theme.bar.menus.menu.clock.border.color": "#333333",
            "theme.bar.menus.menu.clock.time.time": "#ffffff",
            "theme.bar.menus.menu.clock.time.timeperiod": "#ffffff",
            "theme.bar.menus.menu.clock.calendar.yearmonth": "#ffffff",
            "theme.bar.menus.menu.clock.calendar.weekdays": "#ffffff",
            "theme.bar.menus.menu.clock.calendar.paginator": "#ffffff",
            "theme.bar.menus.menu.clock.calendar.currentday": "#ffffff",
            "theme.bar.menus.menu.clock.calendar.days": "#7f7f7f",
            "theme.bar.menus.menu.clock.weather.icon": "#ffffff",
            "theme.bar.menus.menu.clock.weather.temperature": "#ffffff",
            "theme.bar.menus.menu.clock.weather.status": "#ffffff",
            "theme.bar.menus.menu.clock.weather.stats": "#ffffff",
            "theme.bar.menus.menu.clock.weather.hourly.time": "#ffffff",
            "theme.bar.menus.menu.clock.weather.hourly.icon": "#ffffff",
            "theme.bar.menus.menu.clock.weather.hourly.temperature": "#ffffff",
            "theme.bar.menus.menu.dashboard.card.color": "#242424",
            "theme.bar.menus.menu.dashboard.background.color": "#1e1e1e",
            "theme.bar.menus.menu.dashboard.border.color": "#333333",
            "theme.bar.menus.menu.dashboard.profile.name": "#ffffff",
            "theme.bar.menus.menu.dashboard.powermenu.shutdown": "${accentColor}",
            "theme.bar.menus.menu.dashboard.powermenu.restart": "${accentColor}",
            "theme.bar.menus.menu.dashboard.powermenu.logout": "${accentColor}",
            "theme.bar.menus.menu.dashboard.powermenu.sleep": "${accentColor}",
            "theme.bar.menus.menu.dashboard.powermenu.confirmation.card": "#242424",
            "theme.bar.menus.menu.dashboard.powermenu.confirmation.background": "#1e1e1e",
            "theme.bar.menus.menu.dashboard.powermenu.confirmation.border": "#333333",
            "theme.bar.menus.menu.dashboard.powermenu.confirmation.label": "#ffffff",
            "theme.bar.menus.menu.dashboard.powermenu.confirmation.body": "#ffffff",
            "theme.bar.menus.menu.dashboard.powermenu.confirmation.button_text": "#11111a",
            "theme.bar.menus.menu.dashboard.powermenu.confirmation.deny": "#f38ba8",
            "theme.bar.menus.menu.dashboard.powermenu.confirmation.confirm": "#a6e3a1",
            "theme.bar.menus.menu.dashboard.shortcuts.background": "${accentColor}",
            "theme.bar.menus.menu.dashboard.shortcuts.recording": "#a6e3a1",
            "theme.bar.menus.menu.dashboard.controls.disabled": "#606060",
            "theme.bar.menus.menu.dashboard.controls.wifi.background": "${accentColor}",
            "theme.bar.menus.menu.dashboard.controls.bluetooth.background": "${accentColor}",
            "theme.bar.menus.menu.dashboard.controls.notifications.background": "${accentColor}",
            "theme.bar.menus.menu.dashboard.controls.volume.background": "${accentColor}",
            "theme.bar.menus.menu.dashboard.controls.wifi.text": "#181824",
            "theme.bar.menus.menu.dashboard.controls.bluetooth.text": "#181824",
            "theme.bar.menus.menu.dashboard.controls.notifications.text": "#181824",
            "theme.bar.menus.menu.dashboard.controls.volume.text": "#181824",
            "theme.bar.menus.menu.dashboard.controls.input.background": "${accentColor}",
            "theme.bar.menus.menu.dashboard.controls.input.text": "#181824",
            "theme.bar.menus.menu.dashboard.shortcuts.text": "#181824",
            "theme.bar.menus.menu.dashboard.monitors.bar_background": "#363636",
            "theme.bar.menus.menu.dashboard.monitors.cpu.icon": "#ffffff",
            "theme.bar.menus.menu.dashboard.monitors.ram.icon": "#ffffff",
            "theme.bar.menus.menu.dashboard.monitors.gpu.icon": "#ffffff",
            "theme.bar.menus.menu.dashboard.monitors.disk.icon": "#ffffff",
            "theme.bar.menus.menu.dashboard.monitors.cpu.bar": "${accentColor}",
            "theme.bar.menus.menu.dashboard.monitors.cpu.label": "#ffffff",
            "theme.bar.menus.menu.dashboard.monitors.ram.label": "#ffffff",
            "theme.bar.menus.menu.dashboard.monitors.gpu.label": "#ffffff",
            "theme.bar.menus.menu.dashboard.monitors.disk.label": "#ffffff",
            "theme.bar.menus.menu.dashboard.monitors.ram.bar": "${accentColor}",
            "theme.bar.menus.menu.dashboard.monitors.gpu.bar": "${accentColor}",
            "theme.bar.menus.menu.dashboard.monitors.disk.bar": "${accentColor}",
            "theme.bar.menus.menu.media.song": "#ffffff",
            "theme.bar.menus.menu.media.artist": "#9c9c9c",
            "theme.bar.menus.menu.media.album": "#9c9c9c",
            "theme.bar.menus.menu.media.timestamp": "#ffffff",
            "theme.bar.menus.menu.media.background.color": "#1e1e1e",
            "theme.bar.menus.menu.media.border.color": "#333333",
            "theme.bar.menus.menu.media.card.color": "#242424",
            "theme.bar.menus.menu.media.card.tint": 100,
            "theme.bar.menus.menu.media.buttons.inactive": "#3a3a3a",
            "theme.bar.menus.menu.media.buttons.enabled": "${accentColor}",
            "theme.bar.menus.menu.media.buttons.background": "#606060",
            "theme.bar.menus.menu.media.buttons.text": "#ffffff",
            "theme.bar.menus.menu.media.slider.primary": "${accentColor}",
            "theme.bar.menus.menu.media.slider.background": "#363636",
            "theme.bar.menus.menu.media.slider.puck": "#ffffff",
            "theme.bar.menus.menu.media.slider.backgroundhover": "#3c3c3c",
            "theme.bar.menus.menu.network.text": "#ffffff",
            "theme.bar.menus.menu.network.card.color": "#242424",
            "theme.bar.menus.menu.network.background.color": "#1e1e1e",
            "theme.bar.menus.menu.network.border.color": "#333333",
            "theme.bar.menus.menu.network.label.color": "#ffffff",
            "theme.bar.menus.menu.network.status.color": "#ffffff",
            "theme.bar.menus.menu.network.switch.enabled": "#7b56bf",
            "theme.bar.menus.menu.network.switch.disabled": "#545454",
            "theme.bar.menus.menu.network.switch.puck": "#ffffff",
            "theme.bar.menus.menu.network.listitems.active": "#ffffff",
            "theme.bar.menus.menu.network.listitems.passive": "#939393",
            "theme.bar.menus.menu.network.icons.active": "#ffffff",
            "theme.bar.menus.menu.network.icons.passive": "#939393",
            "theme.bar.menus.menu.network.scroller.color": "#505050",
            "theme.bar.menus.menu.network.iconbuttons.active": "#9c9c9c",
            "theme.bar.menus.menu.network.iconbuttons.passive": "#ffffff",
            "theme.bar.menus.menu.notifications.label": "#ffffff",
            "theme.bar.menus.menu.notifications.card": "#242424",
            "theme.bar.menus.menu.notifications.background": "#1e1e1e",
            "theme.bar.menus.menu.notifications.no_notifications_label": "#9c9c9c",
            "theme.bar.menus.menu.notifications.border": "#333333",
            "theme.bar.menus.menu.notifications.switch.enabled": "${accentColor}",
            "theme.bar.menus.menu.notifications.switch.disabled": "#545454",
            "theme.bar.menus.menu.notifications.switch.puck": "#ffffff",
            "theme.bar.menus.menu.notifications.scrollbar.color": "#505050",
            "theme.bar.menus.menu.notifications.pager.background": "#242424",
            "theme.bar.menus.menu.notifications.pager.button": "#ffffff",
            "theme.bar.menus.menu.notifications.pager.label": "#ffffff",
            "theme.bar.menus.menu.notifications.switch_divider": "#373737",
            "theme.notification.background": "#242424",
            "theme.notification.actions.background": "#363636",
            "theme.notification.label": "#ffffff",
            "theme.notification.border": "#333333",
            "theme.notification.time": "#9c9c9c",
            "theme.notification.text": "#ffffff",
            "theme.notification.labelicon": "#ffffff",
            "theme.bar.menus.menu.volume.text": "#ffffff",
            "theme.bar.menus.menu.volume.card.color": "#242424",
            "theme.bar.menus.menu.volume.background.color": "#1e1e1e",
            "theme.bar.menus.menu.volume.border.color": "#333333",
            "theme.bar.menus.menu.volume.label.color": "#ffffff",
            "theme.bar.menus.menu.volume.listitems.passive": "#ffffff",
            "theme.bar.menus.menu.volume.iconbutton.passive": "#ffffff",
            "theme.bar.menus.menu.volume.listitems.active": "#969696",
            "theme.bar.menus.menu.volume.iconbutton.active": "#969696",
            "theme.bar.menus.menu.volume.audio_slider.primary": "${accentColor}",
            "theme.bar.menus.menu.volume.audio_slider.background": "#363636",
            "theme.bar.menus.menu.volume.audio_slider.backgroundhover": "#3c3c3c",
            "theme.bar.menus.menu.volume.audio_slider.puck": "#ffffff",
            "theme.bar.menus.menu.volume.input_slider.primary": "${accentColor}",
            "theme.bar.menus.menu.volume.input_slider.background": "#363636",
            "theme.bar.menus.menu.volume.input_slider.backgroundhover": "#3c3c3c",
            "theme.bar.menus.menu.volume.input_slider.puck": "#ffffff",
            "theme.bar.menus.menu.clock.weather.thermometer.extremelyhot": "#ffffff",
            "theme.bar.menus.menu.clock.weather.thermometer.hot": "#ffffff",
            "theme.bar.menus.menu.clock.weather.thermometer.moderate": "#ffffff",
            "theme.bar.menus.menu.clock.weather.thermometer.cold": "#ffffff",
            "theme.bar.menus.menu.clock.weather.thermometer.extremelycold": "#ffffff",
            "theme.osd.border.color": "#333333",
            "theme.osd.bar_color": "${accentColor}",
            "theme.osd.bar_empty_color": "#363636",
            "theme.osd.bar_container": "#242424",
            "theme.osd.icon": "#ffffff",
            "theme.osd.icon_container": "#363636",
            "theme.osd.label": "#ffffff",
            "theme.font.size": "1.1rem",
            "tear": true,
            "menus.transition": "crossfade",
            "theme.bar.menus.menu.power.scaling": 100,
            "theme.bar.floating": false,
            "theme.bar.location": "top",
            "bar.autoHide": "never",
            "theme.bar.buttons.enableBorders": false,
            "menus.media.hideAuthor": false,
            "menus.media.hideAlbum": false,
            "menus.media.displayTime": true,
            "menus.media.displayTimeTooltip": false,
            "theme.notification.border_radius": "0.5em",
            "notifications.active_monitor": false,
            "notifications.timeout": 5000,
            "theme.bar.menus.menu.notifications.height": "60em",
            "theme.osd.duration": 1500,
            "theme.osd.orientation": "vertical",
            "theme.osd.location": "right",
            "theme.osd.margins": "0px 5px 0px 0px",
            "theme.osd.border.size": "0.1em",
            "theme.osd.radius": "0.5em",
            "menus.volume.raiseMaximumVolume": false,
            "menus.clock.time.military": true,
            "menus.clock.time.hideSeconds": false,
            "menus.clock.weather.enabled": false,
            "menus.clock.weather.location": "Los Angeles",
            "menus.clock.weather.unit": "metric",
            "theme.notification.actions.text": "#ffffff",
            "menus.dashboard.stats.interval": 1000,
            "menus.dashboard.shortcuts.left.shortcut1.icon": "",
            "menus.dashboard.shortcuts.left.shortcut1.command": "",
            "menus.dashboard.shortcuts.left.shortcut1.tooltip": "",
            "menus.dashboard.shortcuts.left.shortcut2.tooltip": "",
            "menus.dashboard.shortcuts.left.shortcut2.command": "",
            "menus.dashboard.shortcuts.left.shortcut2.icon": "",
            "menus.dashboard.shortcuts.left.shortcut3.tooltip": "",
            "menus.dashboard.shortcuts.left.shortcut3.command": "",
            "menus.dashboard.shortcuts.left.shortcut3.icon": "",
            "menus.dashboard.shortcuts.left.shortcut4.tooltip": "",
            "menus.dashboard.shortcuts.left.shortcut4.command": "",
            "menus.dashboard.shortcuts.left.shortcut4.icon": "",
            "menus.dashboard.shortcuts.right.shortcut1.command": "",
            "menus.dashboard.shortcuts.right.shortcut1.tooltip": "",
            "menus.dashboard.shortcuts.right.shortcut1.icon": "",
            "menus.dashboard.directories.enabled": false,
            "theme.bar.menus.menu.dashboard.profile.size": "9.5em",
            "theme.bar.menus.menu.dashboard.profile.radius": "0.5em",
            "menus.dashboard.powermenu.avatar.image": "~/.config/hyprpanel/profile.png",
            "menus.dashboard.powermenu.avatar.name": "Hyprland",
            "theme.bar.outer_spacing": "0em",
            "theme.bar.buttons.y_margins": "0.25em",
            "theme.bar.buttons.radius": "0.5em",
            "bar.launcher.autoDetectIcon": false,
            "theme.bar.buttons.dashboard.enableBorder": false,
            "bar.workspaces.showAllActive": false,
            "bar.workspaces.workspaces": 0,
            "bar.windowtitle.icon": false,
            "bar.volume.label": true,
            "bar.network.label": true,
            "bar.network.showWifiInfo": true,
            "bar.battery.label": true,
            "bar.clock.format": "%H:%M:%S",
            "bar.clock.showIcon": false,
            "bar.clock.showTime": true,
            "theme.bar.buttons.clock.spacing": "0em",
            "bar.media.show_active_only": true,
            "bar.notifications.show_total": true,
            "bar.notifications.hideCountWhenZero": true,
            "bar.layouts": {
              "*": {
                "left": [
                  "workspaces",
                  "media"
                ],
                "middle": [
                  "windowtitle"
                ],
                "right": [
                  "hypridle",
                  "kbinput",
                  "volume",
                  "network",
                  ${if (cfg.hardware.bluetooth) then ''"bluetooth",'' else ""}
                  ${if (cfg.hardware.devices.laptop) then ''"battery",'' else ""}
                  "systray",
                  "clock",
                  "notifications",
                  "dashboard"
                ]
              }
            },
            "theme.bar.buttons.modules.netstat.enableBorder": false,
            "bar.customModules.netstat.dynamicIcon": false,
            "bar.customModules.netstat.icon": "",
            "bar.customModules.netstat.label": true,
            "bar.customModules.netstat.rateUnit": "auto",
            "theme.bar.buttons.modules.netstat.spacing": "0em",
            "bar.customModules.netstat.labelType": "full",
            "bar.customModules.netstat.round": true,
            "bar.customModules.netstat.pollingInterval": 1000,
            "theme.bar.buttons.modules.netstat.text": "#ffffff",
            "theme.bar.buttons.modules.netstat.icon": "#ffffff",
            "theme.bar.buttons.modules.netstat.background": "#1e1e1e",
            "theme.bar.buttons.modules.netstat.icon_background": "#1e1e1e",
            "theme.bar.buttons.modules.hypridle.enableBorder": false,
            "bar.customModules.hypridle.onLabel": "On",
            "bar.customModules.hypridle.offLabel": "Off",
            "theme.bar.buttons.modules.hypridle.spacing": "0.45em",
            "bar.customModules.hypridle.label": false,
            "bar.customModules.hypridle.pollingInterval": 1000,
            "theme.bar.buttons.modules.hypridle.text": "#f5c2e7",
            "theme.bar.buttons.modules.hypridle.icon": "#ffffff",
            "theme.bar.buttons.modules.hypridle.background": "#1e1e1e",
            "theme.bar.buttons.modules.hypridle.icon_background": "#1e1e1e",
            "theme.bar.buttons.modules.kbLayout.text": "#ffffff",
            "theme.bar.buttons.modules.kbLayout.background": "#1e1e1e",
            "theme.bar.buttons.modules.kbLayout.icon_background": "#1e1e1e",
            "theme.bar.buttons.modules.kbLayout.icon": "#ffffff",
            "bar.customModules.kbLayout.label": true,
            "bar.customModules.kbLayout.labelType": "code",
            "bar.customModules.kbLayout.icon": "",
            "theme.bar.buttons.modules.kbLayout.spacing": "0em",
            "bar.launcher.icon": "",
            "hyprpanel.restartCommand": "${killCommand}",
            "menus.power.shutdown": "systemctl poweroff -i",
            "menus.power.reboot": "systemctl reboot -i",
            "menus.power.sleep": "systemctl suspend -i"
          }
        '';
      };

      ".config/hyprpanel/profile.png".source = ./profile.png;
    };

    systemd.user.services.hyprpanel = {
      Unit.Description = "Hyprpanel - Bar";
      Install.WantedBy = [ "graphical-session.target" ];

      Service = {
        ExecStart = "${package}/bin/hyprpanel";
        Nice = "-20";
        Restart = "on-failure";
        StartLimitIntervalSec = 60;
        StartLimitBurst = 60;
      };
    };
  }) cfg.system.users;
}
